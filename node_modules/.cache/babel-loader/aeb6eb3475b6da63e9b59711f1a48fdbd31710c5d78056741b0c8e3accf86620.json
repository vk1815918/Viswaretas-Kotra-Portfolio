{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getPreviewFromContent = exports.getLinkPreview = void 0;\nvar cheerio_1 = __importDefault(require(\"cheerio\"));\nvar cross_fetch_1 = require(\"cross-fetch\");\nvar abort_controller_1 = __importDefault(require(\"abort-controller\"));\nvar url_1 = __importDefault(require(\"url\"));\nvar constants_1 = require(\"./constants\");\nfunction throwOnLoopback(address) {\n  if (constants_1.CONSTANTS.REGEX_LOOPBACK.test(address)) {\n    throw new Error(\"SSRF request detected, trying to query host\");\n  }\n}\nfunction metaTag(doc, type, attr) {\n  var nodes = doc(\"meta[\".concat(attr, \"='\").concat(type, \"']\"));\n  return nodes.length ? nodes : null;\n}\nfunction metaTagContent(doc, type, attr) {\n  return doc(\"meta[\".concat(attr, \"='\").concat(type, \"']\")).attr(\"content\");\n}\nfunction getTitle(doc) {\n  var title = metaTagContent(doc, \"og:title\", \"property\") || metaTagContent(doc, \"og:title\", \"name\");\n  if (!title) {\n    title = doc(\"title\").text();\n  }\n  return title;\n}\nfunction getSiteName(doc) {\n  var siteName = metaTagContent(doc, \"og:site_name\", \"property\") || metaTagContent(doc, \"og:site_name\", \"name\");\n  return siteName;\n}\nfunction getDescription(doc) {\n  var description = metaTagContent(doc, \"description\", \"name\") || metaTagContent(doc, \"Description\", \"name\") || metaTagContent(doc, \"og:description\", \"property\");\n  return description;\n}\nfunction getMediaType(doc) {\n  var node = metaTag(doc, \"medium\", \"name\");\n  if (node) {\n    var content = node.attr(\"content\");\n    return content === \"image\" ? \"photo\" : content;\n  }\n  return metaTagContent(doc, \"og:type\", \"property\") || metaTagContent(doc, \"og:type\", \"name\");\n}\nfunction getImages(doc, rootUrl, imagesPropertyType) {\n  var images = [];\n  var nodes;\n  var src;\n  var dic = {};\n  var imagePropertyType = imagesPropertyType !== null && imagesPropertyType !== void 0 ? imagesPropertyType : \"og\";\n  nodes = metaTag(doc, \"\".concat(imagePropertyType, \":image\"), \"property\") || metaTag(doc, \"\".concat(imagePropertyType, \":image\"), \"name\");\n  if (nodes) {\n    nodes.each(function (_, node) {\n      if (node.type === \"tag\") {\n        src = node.attribs.content;\n        if (src) {\n          src = url_1.default.resolve(rootUrl, src);\n          images.push(src);\n        }\n      }\n    });\n  }\n  if (images.length <= 0 && !imagesPropertyType) {\n    src = doc(\"link[rel=image_src]\").attr(\"href\");\n    if (src) {\n      src = url_1.default.resolve(rootUrl, src);\n      images = [src];\n    } else {\n      nodes = doc(\"img\");\n      if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n        dic = {};\n        images = [];\n        nodes.each(function (_, node) {\n          if (node.type === \"tag\") src = node.attribs.src;\n          if (src && !dic[src]) {\n            dic[src] = true;\n            // width = node.attribs.width;\n            // height = node.attribs.height;\n            images.push(url_1.default.resolve(rootUrl, src));\n          }\n        });\n      }\n    }\n  }\n  return images;\n}\nfunction getVideos(doc) {\n  var videos = [];\n  var nodeTypes;\n  var nodeSecureUrls;\n  var nodeType;\n  var nodeSecureUrl;\n  var video;\n  var videoType;\n  var videoSecureUrl;\n  var width;\n  var height;\n  var videoObj;\n  var index;\n  var nodes = metaTag(doc, \"og:video\", \"property\") || metaTag(doc, \"og:video\", \"name\");\n  if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n    nodeTypes = metaTag(doc, \"og:video:type\", \"property\") || metaTag(doc, \"og:video:type\", \"name\");\n    nodeSecureUrls = metaTag(doc, \"og:video:secure_url\", \"property\") || metaTag(doc, \"og:video:secure_url\", \"name\");\n    width = metaTagContent(doc, \"og:video:width\", \"property\") || metaTagContent(doc, \"og:video:width\", \"name\");\n    height = metaTagContent(doc, \"og:video:height\", \"property\") || metaTagContent(doc, \"og:video:height\", \"name\");\n    for (index = 0; index < nodes.length; index += 1) {\n      var node = nodes[index];\n      if (node.type === \"tag\") video = node.attribs.content;\n      nodeType = nodeTypes === null || nodeTypes === void 0 ? void 0 : nodeTypes[index];\n      if ((nodeType === null || nodeType === void 0 ? void 0 : nodeType.type) === \"tag\") {\n        videoType = nodeType ? nodeType.attribs.content : null;\n      }\n      nodeSecureUrl = nodeSecureUrls === null || nodeSecureUrls === void 0 ? void 0 : nodeSecureUrls[index];\n      if ((nodeSecureUrl === null || nodeSecureUrl === void 0 ? void 0 : nodeSecureUrl.type) === \"tag\") {\n        videoSecureUrl = nodeSecureUrl ? nodeSecureUrl.attribs.content : null;\n      }\n      videoObj = {\n        url: video,\n        secureUrl: videoSecureUrl,\n        type: videoType,\n        width: width,\n        height: height\n      };\n      if (videoType && videoType.indexOf(\"video/\") === 0) {\n        videos.splice(0, 0, videoObj);\n      } else {\n        videos.push(videoObj);\n      }\n    }\n  }\n  return videos;\n}\n// returns default favicon (//hostname/favicon.ico) for a url\nfunction getDefaultFavicon(rootUrl) {\n  return url_1.default.resolve(rootUrl, \"/favicon.ico\");\n}\n// returns an array of URLs to favicon images\nfunction getFavicons(doc, rootUrl) {\n  var images = [];\n  var nodes = [];\n  var src;\n  var relSelectors = [\"rel=icon\", \"rel=\\\"shortcut icon\\\"\", \"rel=apple-touch-icon\"];\n  relSelectors.forEach(function (relSelector) {\n    // look for all icon tags\n    nodes = doc(\"link[\".concat(relSelector, \"]\"));\n    // collect all images from icon tags\n    if (nodes.length) {\n      nodes.each(function (_, node) {\n        if (node.type === \"tag\") src = node.attribs.href;\n        if (src) {\n          src = url_1.default.resolve(rootUrl, src);\n          images.push(src);\n        }\n      });\n    }\n  });\n  // if no icon images, use default favicon location\n  if (images.length <= 0) {\n    images.push(getDefaultFavicon(rootUrl));\n  }\n  return images;\n}\nfunction parseImageResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"image\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\nfunction parseAudioResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"audio\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\nfunction parseVideoResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"video\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\nfunction parseApplicationResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"application\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\nfunction parseTextResponse(body, url, options, contentType) {\n  if (options === void 0) {\n    options = {};\n  }\n  var doc = cheerio_1.default.load(body);\n  return {\n    url: url,\n    title: getTitle(doc),\n    siteName: getSiteName(doc),\n    description: getDescription(doc),\n    mediaType: getMediaType(doc) || \"website\",\n    contentType: contentType,\n    images: getImages(doc, url, options.imagesPropertyType),\n    videos: getVideos(doc),\n    favicons: getFavicons(doc, url)\n  };\n}\nfunction parseUnknownResponse(body, url, options, contentType) {\n  if (options === void 0) {\n    options = {};\n  }\n  return parseTextResponse(body, url, options, contentType);\n}\nfunction parseResponse(response, options) {\n  try {\n    // console.log(\"[link-preview-js] response\", response);\n    var contentType = response.headers[\"content-type\"];\n    var contentTypeTokens = [];\n    var charset = null;\n    if (!contentType) {\n      return parseUnknownResponse(response.data, response.url, options);\n    }\n    if (contentType.includes(\";\")) {\n      contentTypeTokens = contentType.split(\";\");\n      contentType = contentTypeTokens[0];\n      for (var _i = 0, contentTypeTokens_1 = contentTypeTokens; _i < contentTypeTokens_1.length; _i++) {\n        var token = contentTypeTokens_1[_i];\n        if (token.indexOf(\"charset=\") !== -1) {\n          charset = token.split(\"=\")[1];\n        }\n      }\n    }\n    // parse response depending on content type\n    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_IMAGE.test(contentType)) {\n      return __assign(__assign({}, parseImageResponse(response.url, contentType)), {\n        charset: charset\n      });\n    }\n    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_AUDIO.test(contentType)) {\n      return __assign(__assign({}, parseAudioResponse(response.url, contentType)), {\n        charset: charset\n      });\n    }\n    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_VIDEO.test(contentType)) {\n      return __assign(__assign({}, parseVideoResponse(response.url, contentType)), {\n        charset: charset\n      });\n    }\n    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_TEXT.test(contentType)) {\n      var htmlString_1 = response.data;\n      return __assign(__assign({}, parseTextResponse(htmlString_1, response.url, options, contentType)), {\n        charset: charset\n      });\n    }\n    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_APPLICATION.test(contentType)) {\n      return __assign(__assign({}, parseApplicationResponse(response.url, contentType)), {\n        charset: charset\n      });\n    }\n    var htmlString = response.data;\n    return __assign(__assign({}, parseUnknownResponse(htmlString, response.url, options)), {\n      charset: charset\n    });\n  } catch (e) {\n    throw new Error(\"link-preview-js could not fetch link information \".concat(e.toString()));\n  }\n}\n/**\n * Parses the text, extracts the first link it finds and does a HTTP request\n * to fetch the website content, afterwards it tries to parse the internal HTML\n * and extract the information via meta tags\n * @param text string, text to be parsed\n * @param options ILinkPreviewOptions\n */\nfunction getLinkPreview(text, options) {\n  var _a, _b, _c;\n  return __awaiter(this, void 0, void 0, function () {\n    var detectedUrl, resolvedUrl, timeout, controller, timeoutCounter, fetchOptions, fetchUrl, response, forwardedUrl, resolvedUrl, headers, normalizedResponse;\n    var _d;\n    return __generator(this, function (_e) {\n      switch (_e.label) {\n        case 0:\n          if (!text || typeof text !== \"string\") {\n            throw new Error(\"link-preview-js did not receive a valid url or text\");\n          }\n          detectedUrl = text.replace(/\\n/g, \" \").split(\" \").find(function (token) {\n            return constants_1.CONSTANTS.REGEX_VALID_URL.test(token);\n          });\n          if (!detectedUrl) {\n            throw new Error(\"link-preview-js did not receive a valid a url or text\");\n          }\n          if ((options === null || options === void 0 ? void 0 : options.followRedirects) === \"manual\" && !(options === null || options === void 0 ? void 0 : options.handleRedirects)) {\n            throw new Error(\"link-preview-js followRedirects is set to manual, but no handleRedirects function was provided\");\n          }\n          if (!!!(options === null || options === void 0 ? void 0 : options.resolveDNSHost)) return [3 /*break*/, 2];\n          return [4 /*yield*/, options.resolveDNSHost(detectedUrl)];\n        case 1:\n          resolvedUrl = _e.sent();\n          throwOnLoopback(resolvedUrl);\n          _e.label = 2;\n        case 2:\n          timeout = (_a = options === null || options === void 0 ? void 0 : options.timeout) !== null && _a !== void 0 ? _a : 3000;\n          controller = new abort_controller_1.default();\n          timeoutCounter = setTimeout(function () {\n            return controller.abort();\n          }, timeout);\n          fetchOptions = {\n            headers: (_b = options === null || options === void 0 ? void 0 : options.headers) !== null && _b !== void 0 ? _b : {},\n            redirect: (_c = options === null || options === void 0 ? void 0 : options.followRedirects) !== null && _c !== void 0 ? _c : \"error\",\n            signal: controller.signal\n          };\n          fetchUrl = (options === null || options === void 0 ? void 0 : options.proxyUrl) ? options.proxyUrl.concat(detectedUrl) : detectedUrl;\n          return [4 /*yield*/, (0, cross_fetch_1.fetch)(fetchUrl, fetchOptions).catch(function (e) {\n            if (e.name === \"AbortError\") {\n              throw new Error(\"Request timeout\");\n            }\n            clearTimeout(timeoutCounter);\n            throw e;\n          })];\n        case 3:\n          response = _e.sent();\n          if (!(response.status > 300 && response.status < 309 && fetchOptions.redirect === \"manual\" && (options === null || options === void 0 ? void 0 : options.handleRedirects))) return [3 /*break*/, 7];\n          forwardedUrl = response.headers.get(\"location\") || \"\";\n          if (!options.handleRedirects(fetchUrl, forwardedUrl)) {\n            throw new Error(\"link-preview-js could not handle redirect\");\n          }\n          if (!!!(options === null || options === void 0 ? void 0 : options.resolveDNSHost)) return [3 /*break*/, 5];\n          return [4 /*yield*/, options.resolveDNSHost(forwardedUrl)];\n        case 4:\n          resolvedUrl = _e.sent();\n          throwOnLoopback(resolvedUrl);\n          _e.label = 5;\n        case 5:\n          return [4 /*yield*/, (0, cross_fetch_1.fetch)(forwardedUrl, fetchOptions)];\n        case 6:\n          response = _e.sent();\n          _e.label = 7;\n        case 7:\n          clearTimeout(timeoutCounter);\n          headers = {};\n          response.headers.forEach(function (header, key) {\n            headers[key] = header;\n          });\n          _d = {\n            url: (options === null || options === void 0 ? void 0 : options.proxyUrl) ? response.url.replace(options.proxyUrl, \"\") : response.url,\n            headers: headers\n          };\n          return [4 /*yield*/, response.text()];\n        case 8:\n          normalizedResponse = (_d.data = _e.sent(), _d);\n          return [2 /*return*/, parseResponse(normalizedResponse, options)];\n      }\n    });\n  });\n}\nexports.getLinkPreview = getLinkPreview;\n/**\n * Skip the library fetching the website for you, instead pass a response object\n * from whatever source you get and use the internal parsing of the HTML to return\n * the necessary information\n * @param response Preview Response\n * @param options IPreviewLinkOptions\n */\nfunction getPreviewFromContent(response, options) {\n  return __awaiter(this, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n      if (!response || typeof response !== \"object\") {\n        throw new Error(\"link-preview-js did not receive a valid response object\");\n      }\n      if (!response.url) {\n        throw new Error(\"link-preview-js did not receive a valid response object\");\n      }\n      return [2 /*return*/, parseResponse(response, options)];\n    });\n  });\n}\nexports.getPreviewFromContent = getPreviewFromContent;","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__importDefault","mod","__esModule","defineProperty","exports","getPreviewFromContent","getLinkPreview","cheerio_1","require","cross_fetch_1","abort_controller_1","url_1","constants_1","throwOnLoopback","address","CONSTANTS","REGEX_LOOPBACK","test","Error","metaTag","doc","type","attr","nodes","concat","metaTagContent","getTitle","title","text","getSiteName","siteName","getDescription","description","getMediaType","node","content","getImages","rootUrl","imagesPropertyType","images","src","dic","imagePropertyType","each","attribs","default","getVideos","videos","nodeTypes","nodeSecureUrls","nodeType","nodeSecureUrl","video","videoType","videoSecureUrl","width","height","videoObj","index","url","secureUrl","indexOf","splice","getDefaultFavicon","getFavicons","relSelectors","forEach","relSelector","href","parseImageResponse","contentType","mediaType","favicons","parseAudioResponse","parseVideoResponse","parseApplicationResponse","parseTextResponse","options","load","parseUnknownResponse","parseResponse","response","headers","contentTypeTokens","charset","data","includes","split","_i","contentTypeTokens_1","token","REGEX_CONTENT_TYPE_IMAGE","REGEX_CONTENT_TYPE_AUDIO","REGEX_CONTENT_TYPE_VIDEO","REGEX_CONTENT_TYPE_TEXT","htmlString_1","REGEX_CONTENT_TYPE_APPLICATION","htmlString","toString","_a","_b","_c","detectedUrl","resolvedUrl","timeout","controller","timeoutCounter","fetchOptions","fetchUrl","forwardedUrl","normalizedResponse","_d","_e","replace","find","REGEX_VALID_URL","followRedirects","handleRedirects","resolveDNSHost","setTimeout","abort","redirect","signal","proxyUrl","fetch","catch","name","clearTimeout","status","get","header","key"],"sources":["C:/Users/vkotr/reactfolio/node_modules/link-preview-js/build/index.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getPreviewFromContent = exports.getLinkPreview = void 0;\nvar cheerio_1 = __importDefault(require(\"cheerio\"));\nvar cross_fetch_1 = require(\"cross-fetch\");\nvar abort_controller_1 = __importDefault(require(\"abort-controller\"));\nvar url_1 = __importDefault(require(\"url\"));\nvar constants_1 = require(\"./constants\");\nfunction throwOnLoopback(address) {\n    if (constants_1.CONSTANTS.REGEX_LOOPBACK.test(address)) {\n        throw new Error(\"SSRF request detected, trying to query host\");\n    }\n}\nfunction metaTag(doc, type, attr) {\n    var nodes = doc(\"meta[\".concat(attr, \"='\").concat(type, \"']\"));\n    return nodes.length ? nodes : null;\n}\nfunction metaTagContent(doc, type, attr) {\n    return doc(\"meta[\".concat(attr, \"='\").concat(type, \"']\")).attr(\"content\");\n}\nfunction getTitle(doc) {\n    var title = metaTagContent(doc, \"og:title\", \"property\") ||\n        metaTagContent(doc, \"og:title\", \"name\");\n    if (!title) {\n        title = doc(\"title\").text();\n    }\n    return title;\n}\nfunction getSiteName(doc) {\n    var siteName = metaTagContent(doc, \"og:site_name\", \"property\") ||\n        metaTagContent(doc, \"og:site_name\", \"name\");\n    return siteName;\n}\nfunction getDescription(doc) {\n    var description = metaTagContent(doc, \"description\", \"name\") ||\n        metaTagContent(doc, \"Description\", \"name\") ||\n        metaTagContent(doc, \"og:description\", \"property\");\n    return description;\n}\nfunction getMediaType(doc) {\n    var node = metaTag(doc, \"medium\", \"name\");\n    if (node) {\n        var content = node.attr(\"content\");\n        return content === \"image\" ? \"photo\" : content;\n    }\n    return (metaTagContent(doc, \"og:type\", \"property\") ||\n        metaTagContent(doc, \"og:type\", \"name\"));\n}\nfunction getImages(doc, rootUrl, imagesPropertyType) {\n    var images = [];\n    var nodes;\n    var src;\n    var dic = {};\n    var imagePropertyType = imagesPropertyType !== null && imagesPropertyType !== void 0 ? imagesPropertyType : \"og\";\n    nodes =\n        metaTag(doc, \"\".concat(imagePropertyType, \":image\"), \"property\") ||\n            metaTag(doc, \"\".concat(imagePropertyType, \":image\"), \"name\");\n    if (nodes) {\n        nodes.each(function (_, node) {\n            if (node.type === \"tag\") {\n                src = node.attribs.content;\n                if (src) {\n                    src = url_1.default.resolve(rootUrl, src);\n                    images.push(src);\n                }\n            }\n        });\n    }\n    if (images.length <= 0 && !imagesPropertyType) {\n        src = doc(\"link[rel=image_src]\").attr(\"href\");\n        if (src) {\n            src = url_1.default.resolve(rootUrl, src);\n            images = [src];\n        }\n        else {\n            nodes = doc(\"img\");\n            if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n                dic = {};\n                images = [];\n                nodes.each(function (_, node) {\n                    if (node.type === \"tag\")\n                        src = node.attribs.src;\n                    if (src && !dic[src]) {\n                        dic[src] = true;\n                        // width = node.attribs.width;\n                        // height = node.attribs.height;\n                        images.push(url_1.default.resolve(rootUrl, src));\n                    }\n                });\n            }\n        }\n    }\n    return images;\n}\nfunction getVideos(doc) {\n    var videos = [];\n    var nodeTypes;\n    var nodeSecureUrls;\n    var nodeType;\n    var nodeSecureUrl;\n    var video;\n    var videoType;\n    var videoSecureUrl;\n    var width;\n    var height;\n    var videoObj;\n    var index;\n    var nodes = metaTag(doc, \"og:video\", \"property\") || metaTag(doc, \"og:video\", \"name\");\n    if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n        nodeTypes =\n            metaTag(doc, \"og:video:type\", \"property\") ||\n                metaTag(doc, \"og:video:type\", \"name\");\n        nodeSecureUrls =\n            metaTag(doc, \"og:video:secure_url\", \"property\") ||\n                metaTag(doc, \"og:video:secure_url\", \"name\");\n        width =\n            metaTagContent(doc, \"og:video:width\", \"property\") ||\n                metaTagContent(doc, \"og:video:width\", \"name\");\n        height =\n            metaTagContent(doc, \"og:video:height\", \"property\") ||\n                metaTagContent(doc, \"og:video:height\", \"name\");\n        for (index = 0; index < nodes.length; index += 1) {\n            var node = nodes[index];\n            if (node.type === \"tag\")\n                video = node.attribs.content;\n            nodeType = nodeTypes === null || nodeTypes === void 0 ? void 0 : nodeTypes[index];\n            if ((nodeType === null || nodeType === void 0 ? void 0 : nodeType.type) === \"tag\") {\n                videoType = nodeType ? nodeType.attribs.content : null;\n            }\n            nodeSecureUrl = nodeSecureUrls === null || nodeSecureUrls === void 0 ? void 0 : nodeSecureUrls[index];\n            if ((nodeSecureUrl === null || nodeSecureUrl === void 0 ? void 0 : nodeSecureUrl.type) === \"tag\") {\n                videoSecureUrl = nodeSecureUrl ? nodeSecureUrl.attribs.content : null;\n            }\n            videoObj = {\n                url: video,\n                secureUrl: videoSecureUrl,\n                type: videoType,\n                width: width,\n                height: height,\n            };\n            if (videoType && videoType.indexOf(\"video/\") === 0) {\n                videos.splice(0, 0, videoObj);\n            }\n            else {\n                videos.push(videoObj);\n            }\n        }\n    }\n    return videos;\n}\n// returns default favicon (//hostname/favicon.ico) for a url\nfunction getDefaultFavicon(rootUrl) {\n    return url_1.default.resolve(rootUrl, \"/favicon.ico\");\n}\n// returns an array of URLs to favicon images\nfunction getFavicons(doc, rootUrl) {\n    var images = [];\n    var nodes = [];\n    var src;\n    var relSelectors = [\n        \"rel=icon\",\n        \"rel=\\\"shortcut icon\\\"\",\n        \"rel=apple-touch-icon\",\n    ];\n    relSelectors.forEach(function (relSelector) {\n        // look for all icon tags\n        nodes = doc(\"link[\".concat(relSelector, \"]\"));\n        // collect all images from icon tags\n        if (nodes.length) {\n            nodes.each(function (_, node) {\n                if (node.type === \"tag\")\n                    src = node.attribs.href;\n                if (src) {\n                    src = url_1.default.resolve(rootUrl, src);\n                    images.push(src);\n                }\n            });\n        }\n    });\n    // if no icon images, use default favicon location\n    if (images.length <= 0) {\n        images.push(getDefaultFavicon(rootUrl));\n    }\n    return images;\n}\nfunction parseImageResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"image\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseAudioResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"audio\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseVideoResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"video\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseApplicationResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"application\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseTextResponse(body, url, options, contentType) {\n    if (options === void 0) { options = {}; }\n    var doc = cheerio_1.default.load(body);\n    return {\n        url: url,\n        title: getTitle(doc),\n        siteName: getSiteName(doc),\n        description: getDescription(doc),\n        mediaType: getMediaType(doc) || \"website\",\n        contentType: contentType,\n        images: getImages(doc, url, options.imagesPropertyType),\n        videos: getVideos(doc),\n        favicons: getFavicons(doc, url),\n    };\n}\nfunction parseUnknownResponse(body, url, options, contentType) {\n    if (options === void 0) { options = {}; }\n    return parseTextResponse(body, url, options, contentType);\n}\nfunction parseResponse(response, options) {\n    try {\n        // console.log(\"[link-preview-js] response\", response);\n        var contentType = response.headers[\"content-type\"];\n        var contentTypeTokens = [];\n        var charset = null;\n        if (!contentType) {\n            return parseUnknownResponse(response.data, response.url, options);\n        }\n        if (contentType.includes(\";\")) {\n            contentTypeTokens = contentType.split(\";\");\n            contentType = contentTypeTokens[0];\n            for (var _i = 0, contentTypeTokens_1 = contentTypeTokens; _i < contentTypeTokens_1.length; _i++) {\n                var token = contentTypeTokens_1[_i];\n                if (token.indexOf(\"charset=\") !== -1) {\n                    charset = token.split(\"=\")[1];\n                }\n            }\n        }\n        // parse response depending on content type\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_IMAGE.test(contentType)) {\n            return __assign(__assign({}, parseImageResponse(response.url, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_AUDIO.test(contentType)) {\n            return __assign(__assign({}, parseAudioResponse(response.url, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_VIDEO.test(contentType)) {\n            return __assign(__assign({}, parseVideoResponse(response.url, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_TEXT.test(contentType)) {\n            var htmlString_1 = response.data;\n            return __assign(__assign({}, parseTextResponse(htmlString_1, response.url, options, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_APPLICATION.test(contentType)) {\n            return __assign(__assign({}, parseApplicationResponse(response.url, contentType)), { charset: charset });\n        }\n        var htmlString = response.data;\n        return __assign(__assign({}, parseUnknownResponse(htmlString, response.url, options)), { charset: charset });\n    }\n    catch (e) {\n        throw new Error(\"link-preview-js could not fetch link information \".concat(e.toString()));\n    }\n}\n/**\n * Parses the text, extracts the first link it finds and does a HTTP request\n * to fetch the website content, afterwards it tries to parse the internal HTML\n * and extract the information via meta tags\n * @param text string, text to be parsed\n * @param options ILinkPreviewOptions\n */\nfunction getLinkPreview(text, options) {\n    var _a, _b, _c;\n    return __awaiter(this, void 0, void 0, function () {\n        var detectedUrl, resolvedUrl, timeout, controller, timeoutCounter, fetchOptions, fetchUrl, response, forwardedUrl, resolvedUrl, headers, normalizedResponse;\n        var _d;\n        return __generator(this, function (_e) {\n            switch (_e.label) {\n                case 0:\n                    if (!text || typeof text !== \"string\") {\n                        throw new Error(\"link-preview-js did not receive a valid url or text\");\n                    }\n                    detectedUrl = text\n                        .replace(/\\n/g, \" \")\n                        .split(\" \")\n                        .find(function (token) { return constants_1.CONSTANTS.REGEX_VALID_URL.test(token); });\n                    if (!detectedUrl) {\n                        throw new Error(\"link-preview-js did not receive a valid a url or text\");\n                    }\n                    if ((options === null || options === void 0 ? void 0 : options.followRedirects) === \"manual\" && !(options === null || options === void 0 ? void 0 : options.handleRedirects)) {\n                        throw new Error(\"link-preview-js followRedirects is set to manual, but no handleRedirects function was provided\");\n                    }\n                    if (!!!(options === null || options === void 0 ? void 0 : options.resolveDNSHost)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, options.resolveDNSHost(detectedUrl)];\n                case 1:\n                    resolvedUrl = _e.sent();\n                    throwOnLoopback(resolvedUrl);\n                    _e.label = 2;\n                case 2:\n                    timeout = (_a = options === null || options === void 0 ? void 0 : options.timeout) !== null && _a !== void 0 ? _a : 3000;\n                    controller = new abort_controller_1.default();\n                    timeoutCounter = setTimeout(function () { return controller.abort(); }, timeout);\n                    fetchOptions = {\n                        headers: (_b = options === null || options === void 0 ? void 0 : options.headers) !== null && _b !== void 0 ? _b : {},\n                        redirect: (_c = options === null || options === void 0 ? void 0 : options.followRedirects) !== null && _c !== void 0 ? _c : \"error\",\n                        signal: controller.signal,\n                    };\n                    fetchUrl = (options === null || options === void 0 ? void 0 : options.proxyUrl)\n                        ? options.proxyUrl.concat(detectedUrl)\n                        : detectedUrl;\n                    return [4 /*yield*/, (0, cross_fetch_1.fetch)(fetchUrl, fetchOptions).catch(function (e) {\n                            if (e.name === \"AbortError\") {\n                                throw new Error(\"Request timeout\");\n                            }\n                            clearTimeout(timeoutCounter);\n                            throw e;\n                        })];\n                case 3:\n                    response = _e.sent();\n                    if (!(response.status > 300 &&\n                        response.status < 309 &&\n                        fetchOptions.redirect === \"manual\" &&\n                        (options === null || options === void 0 ? void 0 : options.handleRedirects))) return [3 /*break*/, 7];\n                    forwardedUrl = response.headers.get(\"location\") || \"\";\n                    if (!options.handleRedirects(fetchUrl, forwardedUrl)) {\n                        throw new Error(\"link-preview-js could not handle redirect\");\n                    }\n                    if (!!!(options === null || options === void 0 ? void 0 : options.resolveDNSHost)) return [3 /*break*/, 5];\n                    return [4 /*yield*/, options.resolveDNSHost(forwardedUrl)];\n                case 4:\n                    resolvedUrl = _e.sent();\n                    throwOnLoopback(resolvedUrl);\n                    _e.label = 5;\n                case 5: return [4 /*yield*/, (0, cross_fetch_1.fetch)(forwardedUrl, fetchOptions)];\n                case 6:\n                    response = _e.sent();\n                    _e.label = 7;\n                case 7:\n                    clearTimeout(timeoutCounter);\n                    headers = {};\n                    response.headers.forEach(function (header, key) {\n                        headers[key] = header;\n                    });\n                    _d = {\n                        url: (options === null || options === void 0 ? void 0 : options.proxyUrl)\n                            ? response.url.replace(options.proxyUrl, \"\")\n                            : response.url,\n                        headers: headers\n                    };\n                    return [4 /*yield*/, response.text()];\n                case 8:\n                    normalizedResponse = (_d.data = _e.sent(),\n                        _d);\n                    return [2 /*return*/, parseResponse(normalizedResponse, options)];\n            }\n        });\n    });\n}\nexports.getLinkPreview = getLinkPreview;\n/**\n * Skip the library fetching the website for you, instead pass a response object\n * from whatever source you get and use the internal parsing of the HTML to return\n * the necessary information\n * @param response Preview Response\n * @param options IPreviewLinkOptions\n */\nfunction getPreviewFromContent(response, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (!response || typeof response !== \"object\") {\n                throw new Error(\"link-preview-js did not receive a valid response object\");\n            }\n            if (!response.url) {\n                throw new Error(\"link-preview-js did not receive a valid response object\");\n            }\n            return [2 /*return*/, parseResponse(response, options)];\n        });\n    });\n}\nexports.getPreviewFromContent = getPreviewFromContent;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}